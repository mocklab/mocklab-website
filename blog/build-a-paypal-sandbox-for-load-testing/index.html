

<!doctype html>
<html lang="en" class="no-js">
  <head>
    <!-- start Mixpanel --><script type="text/javascript">(function(e,a){if(!a.__SV){var b=window;try{var c,l,i,j=b.location,g=j.hash;c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};g&&c(g,"state")&&(i=JSON.parse(decodeURIComponent(c(g,"state"))),"mpeditor"===i.action&&(b.sessionStorage.setItem("_mpcehash",g),history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search)))}catch(m){}var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){function e(b,a){var c=a.split(".");2==c.length&&(b=b[c[0]],a=c[1]);b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,
0)))}}var d=a;"undefined"!==typeof f?d=a[f]=[]:f="mixpanel";d.people=d.people||[];d.toString=function(b){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);b||(a+=" (stub)");return a};d.people.toString=function(){return d.toString(1)+".people (stub)"};k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
for(h=0;h<k.length;h++)e(d,k[h]);a._i.push([b,c,f])};a.__SV=1.2;b=e.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";c=e.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}})(document,window.mixpanel||[]);
mixpanel.init('71b55ac57b47107ca89d12dc7c75cf00', {
    loaded: function(mixpanel) {
        distinct_id = mixpanel.get_distinct_id();
    }
});</script><!-- end Mixpanel -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    

<meta charset="utf-8">



<!-- begin SEO -->









<title>Build a Paypal Sandbox for Load Testing in 10 Minutes | MockLab</title>







<meta name="description" content="Build a mock of the Paypal API to allow end to end load testing of your e-commerce app">

<meta property="og:locale" content="en-US">
<meta property="og:site_name" content="MockLab">
<meta property="og:title" content="Build a Paypal Sandbox for Load Testing in 10 Minutes">




  <meta property="og:description" content="Build a mock of the Paypal API to allow end to end load testing of your e-commerce app">



  <meta property="keywords" content="MockLab,API Mocking,Performance Testing,Paypal">





  

  





  <meta property="og:type" content="article">
  <meta property="article:published_time" content="2018-07-10T00:00:00+01:00">
  
  





  <script type="application/ld+json">
    {
      "@context" : "http://schema.org",
      "@type" : "Person",
      "name" : "",
      "url" : null,
      "sameAs" : null
    }
  </script>






<!-- end SEO -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="MockLab Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<link href="https://fonts.googleapis.com/css?family=Cairo:300" rel="stylesheet">

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<meta http-equiv="cleartype" content="on">

<link rel="shortcut icon" type="image/x-icon" href="/images/favicon.png">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@1/dist/instantsearch.min.css" />
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3.0/dist/instantsearch-theme-algolia.min.css">

    <!-- start custom head snippets -->

<!-- insert favicons. use http://realfavicongenerator.net/ -->

<!-- end custom head snippets -->
  </head>

  <body>
    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->
    

<nav class="header-nav sticky">
  <ul class="header-nav__container">
    <li class="header-nav__logo">
        <a href="https://get.mocklab.io">
            <img src="/images/mocklab_logo_with_text.png" title="MockLab logo"/>
        </a>
    </li>

    <li class="header-nav__item">
        <a href="/docs/getting-started/" title="Docs">Docs</a>
    </li>
    <li class="header-nav__item">
        <a href="/blog/" title="Docs">Blog</a>
    </li>
    <li class="header-nav__item">
        <a href="https://get.mocklab.io/pricing" title="Docs">Pricing</a>
    </li>
    <li class="header-nav__item header-nav__item--last">
        <a href="https://app.mocklab.io" title="Login" target="_blank">Login</a>
    </li>

    <li class="header-nav__cta">
        <a href="https://app.mocklab.io/login?for=signup" title="Sign up" target="_blank">Sign up</a>
    </li>
  </ul>

</nav>

    





<div id="main" role="main">
  



  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="Build a Paypal Sandbox for Load Testing in 10 Minutes">
    <meta itemprop="description" content="">
    <meta itemprop="datePublished" content="July 10, 2018">
    

    <div class="page__inner-wrap">
      <div class="page__return-nav-link">
        <a href="/blog/" title="Back to articles">Back to articles</a>
      </div>

      
        <header>
          <h1 class="page__title" itemprop="headline">Build a Paypal Sandbox for Load Testing in 10 Minutes
</h1>
          

          <p class="page__date">
              <img class="author-pic" src="/images/authors/tom_akehurst.png"/> Tom Akehurst

              
                on <time datetime="2018-07-10T00:00:00+01:00">July 10, 2018</time>
              
          </p>

          <div class="page__meta">
            




  






  
  
  

  <p class="page__taxonomy">
    <span itemprop="keywords">
    
      
      
      <!-- <a href="/categories/#api-mocking" class="page__taxonomy-item" rel="tag">API Mocking</a><span class="sep">, </span> -->
      <span class="page__taxonomy-item">API Mocking<span class="sep">, </span></span>
    
      
      
      <!-- <a href="/categories/#mocklab" class="page__taxonomy-item" rel="tag">MockLab</a><span class="sep">, </span> -->
      <span class="page__taxonomy-item">MockLab<span class="sep">, </span></span>
    
      
      
      <!-- <a href="/categories/#paypal" class="page__taxonomy-item" rel="tag">Paypal</a><span class="sep">, </span> -->
      <span class="page__taxonomy-item">Paypal<span class="sep">, </span></span>
    
      
      
      <!-- <a href="/categories/#performance-testing" class="page__taxonomy-item" rel="tag">Performance Testing</a> -->
      <span class="page__taxonomy-item">Performance Testing</span>
    
    </span>
  </p>



          </div>

        </header>
      

      <section class="page__content" itemprop="text">
        <div class="video">
<script src="https://fast.wistia.com/embed/medias/tz7u9ot0sj.jsonp" async=""></script><script src="https://fast.wistia.com/assets/external/E-v1.js" async=""></script><div class="wistia_responsive_padding" style="padding:56.25% 0 0 0;position:relative;"><div class="wistia_responsive_wrapper" style="height:100%;left:0;position:absolute;top:0;width:100%;"><div class="wistia_embed wistia_async_tz7u9ot0sj videoFoam=true" style="height:100%;position:relative;width:100%"><div class="wistia_swatch" style="height:100%;left:0;opacity:0;overflow:hidden;position:absolute;top:0;transition:opacity 200ms;width:100%;"><img src="https://fast.wistia.com/embed/medias/tz7u9ot0sj/swatch" style="filter:blur(5px);height:100%;object-fit:contain;width:100%;" alt="" onload="this.parentNode.style.opacity=1;" /></div></div></div></div>
</div>

<p>Modern e-commerce websites and apps need to be fast and stable in order to avoid losing swathes of customers to competitors.</p>

<p>Achieving this requires regular performance testing of systems, but this is a problem for sites that accept payments with Paypal since
running high load against their sandbox is specifically prohibited by their terms of service.</p>

<p>So what can you do?</p>

<p>One option is to simply have your load test stop short of the final step of your checkout. This is less than ideal for (hopefully) obvious reasons.</p>

<p>Another option is to mock the part of the app’s code that calls Paypal during load testing. This is an improvement, but still means critical bits of code
used in production won’t be tested.</p>

<p>A better solution is to build a simulation of the Paypal API and connect your test environment to it.</p>

<p>MockLab is a tool specifically built for this purpose, and the rest of this article will focus on how you can use it to quickly construct a mock Paypal API
suitable for performance testing.</p>

<h2 id="setup">Setup</h2>

<p>To begin, you need to have logged into MockLab and created a new, empty mock API. You can <a href="https://app.mocklab.io/login?for=signup" target="_blank">sign up here</a> if you haven’t already.</p>

<p>Once you’ve created a new mock API, grab a copy of its base URL. You can find this in the title bar:</p>

<p><img src="/images/screenshots/paypal-article/base-url.png" alt="Base URL" style="width: 70%" /></p>

<p>You’ll also need the client ID and client secret from your Paypal Sandbox account.</p>

<p>We’ve developed a simple demo app for this tutorial. If you’d like to download and run this you can find it at <a href="https://github.com/mocklab/mocklab-demo-app" target="_blank">https://github.com/mocklab/mocklab-demo-app</a></p>

<p>Once you’ve checked out the app, set the Paypal endpoint in <code class="highlighter-rouge">src/main/resources/application.properties</code> to your mock API’s base URL:</p>

<p><img src="/images/screenshots/paypal-article/app-config.png" alt="Base URL" style="width: 70%" /></p>

<p>Then start the app:</p>

<p>[Linux/OSX]</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="nb">export </span><span class="nv">PAYPAL_CLIENT_ID</span><span class="o">=</span>&lt;your client ID&gt;
<span class="nb">export </span><span class="nv">PAYPAL_CLIENT_SECRET</span><span class="o">=</span>&lt;your client secret&gt;
 ./gradlew bootRun
</code></pre>
</div>

<p>[Windows]</p>

<div class="highlighter-rouge"><pre class="highlight"><code>set PAYPAL_CLIENT_ID=&lt;your client ID&gt;
set PAYPAL_CLIENT_SECRET=&lt;your client secret&gt;
gradlew bootRun
</code></pre>
</div>

<h2 id="recording-initial-stubs">Recording initial stubs</h2>

<p>In MockLab, hit the Record button, set the target URL as Paypal’s sandbox then start recording:</p>

<p><img src="/images/screenshots/paypal-article/recorder.png" alt="Base URL" style="width: 70%; border: none" /></p>

<p>Go to <a href="http://localhost:9000/paypal" target="_blank">http://localhost:9000/paypal</a>, enter an amount and complete a Payment:</p>

<p><img src="/images/screenshots/paypal-article/paypal-demo-app.png" alt="Base URL" style="width: 70%; border: none" /></p>

<p>Return to MockLab and stop recording. You should now see two stubs have been appeared in the list, one for the prepare payment step and one for execute payment.</p>

<p>If you wish you can test these with the internal request maker or an HTTP client like Postman:</p>

<p><img src="/images/screenshots/paypal-article/test-request-1.png" alt="Base URL" /></p>

<h2 id="making-performance-ready">Making performance ready</h2>

<p>Recorded stubs are by default very specific. They will only be matched to an incoming request if the method, URL and body match exactly. In practice this
means they’ll only work for the exact same payment ID and amount.</p>

<p>Additionally they will return the same response each time,
meaning IDs and dates you’d expect to be unique between requests will be the same. This causes problems if, for instance, the payment ID is saved
in a unique field by your app.</p>

<p>All of these issues can be resolved using MockLab’s advanced matching and templated responses.</p>

<h3 id="create-payment">Create payment</h3>

<p>Open the create payment stub first (the one with URL <code class="highlighter-rouge">/v1/payments/payment</code>). The generated name is a bit ugly so you may wish to change this to something
more readable.</p>

<p>Next up, in the Advanced section you’ll notice there’s a body matcher for the exact JSON that was sent during recording. We don’t need this, since we want to respond
to any create payment request, so delete this.</p>

<p><img src="/images/screenshots/paypal-article/request-body.png" alt="Base URL" style="width: 90%; border: none" /></p>

<p>We want to ensure we’re sending a unique payment ID in the response each time. To do this, we need to enable <a href="/docs/response-templating/">response templating</a>:</p>

<p><img src="/images/screenshots/enable-response-templating-screenshot.png" alt="Base URL" style="width: 30%" /></p>

<p>Then we need to generate a random ID for each response. We can do this by first assigning a variable by adding this line at the top of the response body:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="err">{#assign</span><span class="w"> </span><span class="err">'paymentId'</span><span class="p">}</span><span class="err">}PAY-</span><span class="p">{</span><span class="err">{randomValue</span><span class="w"> </span><span class="err">length=24</span><span class="w"> </span><span class="err">type='ALPHANUMERIC'</span><span class="w"> </span><span class="err">uppercase=true</span><span class="p">}</span><span class="err">}</span><span class="p">{</span><span class="err">{/assign</span><span class="p">}</span><span class="err">}</span><span class="w">
</span></code></pre>
</div>

<p>and replacing instances of the payment ID with the variable we set e.g.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>"id": "{{paymentId}}"
</code></pre>
</div>

<p>We also may wish to set the <code class="highlighter-rouge">create_time</code> field to the current time, rather than it being fixed at the one captured at record time:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>"create_time": "{{now}}"
</code></pre>
</div>

<p>Putting it all together it should look something like this:</p>

<p><img src="/images/screenshots/paypal-article/create-payment-body.png" alt="Base URL" style="border: none" /></p>

<h3 id="execute-payment">Execute payment</h3>

<p>We need to give similar treatment to the execute payment stub, with a key difference: rather than generating the payment ID at random,
we want to extract it from the request URL.</p>

<p>You’ll notice the request URL for the execute step is also very specific - it will only match the exact payment ID passed. We can fix this by
converting it to a regular expression (not that the URL match type has also changed to ‘Path Regex’):</p>

<p><img src="/images/screenshots/paypal-article/url-regex.png" alt="Base URL" style="border: none" /></p>

<p>Next we’ll give the response body the same treatment as with the create payment stub, but extracting the ID from the URL:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="err">{#assign</span><span class="w"> </span><span class="err">'paymentId'</span><span class="p">}</span><span class="err">}</span><span class="p">{</span><span class="err">{request.path.[3]</span><span class="p">}</span><span class="err">}</span><span class="p">{</span><span class="err">{/assign</span><span class="p">}</span><span class="err">}</span><span class="w">
</span></code></pre>
</div>

<p>(Ensure you change substitute the <code class="highlighter-rouge">paymentId</code> variables <code class="highlighter-rouge">now</code> variables where appropriate as before)</p>

<h2 id="adding-delays-for-extra-realism">Adding delays for extra realism</h2>

<p>Since stubbed responses tend to return faster than from real APIs, this can create misleading outcomes when performance testing. To remedy this,
you can add some artificial delay to your stubs:</p>

<p><img src="/images/screenshots/paypal-article/random-delay.png" alt="Base URL" style="width: 70%" /></p>

<h2 id="final-test">Final test</h2>

<p>You may wish to quickly test your updated stubs before pressing them into service. Again, you can do this with a tool like Postman, or
with MockLab’s own test request maker:</p>

<p><img src="/images/screenshots/paypal-article/test-requester.png" alt="Base URL" /></p>

<p>And now your Paypal Sandbox is ready to go!</p>

<div class="signup-cta">
  <p class="signup-cta__text">
    If you'd like to try this yourself you can sign up for a free 14 day trial of MockLab.
  It's very quick and easy - log in with GitHub, Google or your email address. No credit card required.
  </p>
  <a href="https://app.mocklab.io/login?for=signup&amp;utm_source=www.mocklab.io&amp;utm_medium=blog&amp;utm_campaign=paypal_sandbox_article-bottom_cta" title="Sign up" target="_blank">Sign up</a>
</div>

        
      </section>

      <footer class="page__meta">
        
      </footer>

      

      


    </div>

    
  </article>

  
  
</div>


    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        

<nav class="page__footer-links">
  <div class="page__footer-links-block">
    <ul>
      <li>&copy; 2018 MockLab</li>
      <li><a href="mailto:info@mocklab.io">info@mocklab.io</a></li>
    </ul>
  </div>

  <div class="page__footer-links-block">
    <h3>Help</h3>
    <ul>
      <li><a href="/docs/getting-started/">Docs</a></li>
      <li><a href="/docs/getting-started/">Blog</a></li>
      <li><a href="https://get.mocklab.io/pricing">Pricing</a></li>
    </ul>
  </div>

  <div class="page__footer-links-block">
    <h3>Policies</h3>
    <ul>
      <li><a href="/docs/terms-and-conditions/">Terms and conditions</a></li>
      <li><a href="/docs/privacy-policy/">Privacy policy</a></li>
    </ul>
  </div>

  <div class="page__footer-links-block">
    <ul>

    </ul>
  </div>
</nav>

      </footer>
    </div>

    <script src="/assets/js/main.min.js"></script>




  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-78148205-6', 'auto');
  ga('send', 'pageview');
</script>




<script>
    window.intercomSettings = {
        app_id: "xjme6u4w"
    };
</script>
<script>(function(){var w=window;var ic=w.Intercom;if(typeof ic==="function"){ic('reattach_activator');ic('update',intercomSettings);}else{var d=document;var i=function(){i.c(arguments)};i.q=[];i.c=function(args){i.q.push(args)};w.Intercom=i;function l(){var s=d.createElement('script');s.type='text/javascript';s.async=true;s.src='https://widget.intercom.io/widget/xjme6u4w';var x=d.getElementsByTagName('script')[0];x.parentNode.insertBefore(s,x);}if(w.attachEvent){w.attachEvent('onload',l);}else{w.addEventListener('load',l,false);}}})()</script>


  </body>
</html>

