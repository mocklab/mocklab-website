

<!doctype html>
<html lang="en" class="no-js">
  <head>
    <!-- start Mixpanel --><script type="text/javascript">(function(e,a){if(!a.__SV){var b=window;try{var c,l,i,j=b.location,g=j.hash;c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};g&&c(g,"state")&&(i=JSON.parse(decodeURIComponent(c(g,"state"))),"mpeditor"===i.action&&(b.sessionStorage.setItem("_mpcehash",g),history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search)))}catch(m){}var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){function e(b,a){var c=a.split(".");2==c.length&&(b=b[c[0]],a=c[1]);b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,
0)))}}var d=a;"undefined"!==typeof f?d=a[f]=[]:f="mixpanel";d.people=d.people||[];d.toString=function(b){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);b||(a+=" (stub)");return a};d.people.toString=function(){return d.toString(1)+".people (stub)"};k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset people.set people.set_once people.unset people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
for(h=0;h<k.length;h++)e(d,k[h]);a._i.push([b,c,f])};a.__SV=1.2;b=e.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";c=e.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}})(document,window.mixpanel||[]);
mixpanel.init('71b55ac57b47107ca89d12dc7c75cf00', {
    loaded: function(mixpanel) {
        distinct_id = mixpanel.get_distinct_id();
    }
});</script><!-- end Mixpanel -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    

<meta charset="utf-8">



<!-- begin SEO -->









<title>Simulating State with Scenarios | MockLab</title>







<meta name="description" content="Return different responses based on a state machine">

<meta property="og:locale" content="en-US">
<meta property="og:site_name" content="MockLab">
<meta property="og:title" content="Simulating State with Scenarios">




  <meta property="og:description" content="Return different responses based on a state machine">



  <meta property="keywords" content="">





  

  



  <meta property="og:image" content="https://www.mocklab.io/images/mocklab_logo_with_text_large.png">



  <meta property="og:type" content="article">
  <meta property="article:published_time" content="2020-10-12T11:14:36+01:00">
  
    <link rel="next" href="/docs/stubbing/" title="Stubbing Basics">
  
  
    <link rel="prev" href="/docs/soap-stubbing/" title="Working with SOAP">
  



  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Organization",
      "url": null,
      "logo": "/images/https://www.mocklab.io/images/mocklab_logo_with_text_large.png"
    }
  </script>



  <script type="application/ld+json">
    {
      "@context" : "http://schema.org",
      "@type" : "Person",
      "name" : "",
      "url" : null,
      "sameAs" : null
    }
  </script>






<!-- end SEO -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="MockLab Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<link href="https://fonts.googleapis.com/css?family=Cairo:300" rel="stylesheet">

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<meta http-equiv="cleartype" content="on">

<link rel="shortcut icon" type="image/x-icon" href="/images/favicon.png">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/instantsearch.js@1/dist/instantsearch.min.css" />
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3.0/dist/instantsearch-theme-algolia.min.css">

    <!-- start custom head snippets -->

<!-- insert favicons. use http://realfavicongenerator.net/ -->

<!-- end custom head snippets -->
  </head>

  <body>
    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->
    

<nav class="header-nav sticky">
  <ul class="header-nav__container">
    <li class="header-nav__logo">
        <a href="https://get.mocklab.io">
            <img src="/images/mocklab_logo_with_text.png" title="MockLab logo"/>
        </a>
    </li>

    <li class="header-nav__item">
        <a href="/docs/getting-started/" title="Docs">Docs</a>
    </li>
    <li class="header-nav__item">
        <a href="/blog/" title="Docs">Blog</a>
    </li>
    <li class="header-nav__item">
        <a href="https://get.mocklab.io/pricing" title="Docs">Pricing</a>
    </li>
    <li class="header-nav__item header-nav__item--last">
        <a href="https://app.mocklab.io" title="Login" target="_blank">Login</a>
    </li>

    <li class="header-nav__cta">
        <a href="https://app.mocklab.io/login?for=signup" title="Sign up" target="_blank">Sign up</a>
    </li>
  </ul>

</nav>

    

<div id="main" role="main">
  

<div class="sidebar sticky">
  <nav class="nav__list">
    <ul class="doc-categories">
      
        <li class="doc-category">
          <span class="doc-category__title">Setup & Configuration</span>
          <ul class="doc-category__links">
            
              
              
              <li>
                <a href="/docs/getting-started/">

                
                Getting Started
                </a>
              </li>
            
              
              
              <li>
                <a href="/docs/security/">

                
                Security
                </a>
              </li>
            
          </ul>
        </li>
      
        <li class="doc-category">
          <span class="doc-category__title">Stubbing</span>
          <ul class="doc-category__links">
            
              
              
              <li>
                <a href="/docs/stubbing/">

                
                 Basics
                </a>
              </li>
            
              
              
              <li>
                <a href="/docs/advanced-stubbing/">

                
                Advanced 
                </a>
              </li>
            
              
              
              <li>
                <a href="/docs/delays/">

                
                Response Delays
                </a>
              </li>
            
              
              
              <li>
                <a href="/docs/simulating-faults/">

                
                Simulating Faults
                </a>
              </li>
            
              
              
              <li>
                <a href="/docs/stateful-scenarios/" class="nav__list-item--selected">
                

                
                Simulating State with Scenarios
                </a>
              </li>
            
              
              
              <li>
                <a href="/docs/proxying/">

                
                Proxying
                </a>
              </li>
            
              
              
              <li>
                <a href="/docs/soap-stubbing/">

                
                Working with SOAP
                </a>
              </li>
            
          </ul>
        </li>
      
        <li class="doc-category">
          <span class="doc-category__title">Request Matching</span>
          <ul class="doc-category__links">
            
              
              
              <li>
                <a href="/docs/request-matching/matcher-types/">

                
                Overview of Matcher Types
                </a>
              </li>
            
              
              
              <li>
                <a href="/docs/request-matching/url/">

                
                Matching URLs
                </a>
              </li>
            
              
              
              <li>
                <a href="/docs/request-matching/json/">

                
                Matching JSON requests
                </a>
              </li>
            
              
              
              <li>
                <a href="/docs/request-matching/xml/">

                
                Matching XML bodies
                </a>
              </li>
            
          </ul>
        </li>
      
        <li class="doc-category">
          <span class="doc-category__title">Response Templating</span>
          <ul class="doc-category__links">
            
              
              
              <li>
                <a href="/docs/response-templating/basics/">

                
                Basics
                </a>
              </li>
            
              
              
              <li>
                <a href="/docs/response-templating/conditional-logic-and-iteration/">

                
                Conditional Logic and Iteration
                </a>
              </li>
            
              
              
              <li>
                <a href="/docs/response-templating/string-helpers/">

                
                String Helpers
                </a>
              </li>
            
              
              
              <li>
                <a href="/docs/response-templating/string-encodings/">

                
                String Encodings
                </a>
              </li>
            
              
              
              <li>
                <a href="/docs/response-templating/dates-and-times/">

                
                Dates and Times
                </a>
              </li>
            
              
              
              <li>
                <a href="/docs/response-templating/random-values/">

                
                Random Values
                </a>
              </li>
            
              
              
              <li>
                <a href="/docs/response-templating/xml/">

                
                Working with XML
                </a>
              </li>
            
              
              
              <li>
                <a href="/docs/response-templating/json/">

                
                Working with JSON
                </a>
              </li>
            
              
              
              <li>
                <a href="/docs/response-templating/jwt/">

                
                JSON Web Tokens (JWT)
                </a>
              </li>
            
              
              
              <li>
                <a href="/docs/response-templating/misc-helpers/">

                
                Miscellaneous Helpers
                </a>
              </li>
            
          </ul>
        </li>
      
        <li class="doc-category">
          <span class="doc-category__title">Import & Export</span>
          <ul class="doc-category__links">
            
              
              
              <li>
                <a href="/docs/swagger/">

                
                Swagger Import
                </a>
              </li>
            
              
              
              <li>
                <a href="/docs/import-and-export/">

                
                How to: Import and export your mock API
                </a>
              </li>
            
          </ul>
        </li>
      
        <li class="doc-category">
          <span class="doc-category__title">Record & Playback</span>
          <ul class="doc-category__links">
            
              
              
              <li>
                <a href="/docs/recording-stubs/">

                
                Recording Stubs
                </a>
              </li>
            
          </ul>
        </li>
      
        <li class="doc-category">
          <span class="doc-category__title">Policies</span>
          <ul class="doc-category__links">
            
              
              
              <li>
                <a href="/docs/terms-and-conditions/">

                
                MockLab Terms of Service
                </a>
              </li>
            
              
              
              <li>
                <a href="/docs/privacy-policy/">

                
                Privacy Policy
                </a>
              </li>
            
          </ul>
        </li>
      
        <li class="doc-category">
          <span class="doc-category__title">Tutorials</span>
          <ul class="doc-category__links">
            
              
              
              <li>
                <a href="/docs/exploratory-testing-tutorial/">

                
                Exploratory Testing a Spring Boot App
                </a>
              </li>
            
              
              
              <li>
                <a href="/docs/automated-testing-with-java/">

                
                Automated Testing with Java
                </a>
              </li>
            
              
              
              <li>
                <a href="/docs/default-responses/">

                
                Serving a Default Response
                </a>
              </li>
            
              
              
              <li>
                <a href="/docs/oauth2-mock/">

                
                The OAuth2 / OpenID Connect Mock
                </a>
              </li>
            
          </ul>
        </li>
      
        <li class="doc-category">
          <span class="doc-category__title">API References</span>
          <ul class="doc-category__links">
            
              
              
              <li>
                <a href="/docs/mocking/">

                
                API Reference: Mocking
                </a>
              </li>
            
              
              
              <li>
                <a href="/docs/provisioning/">

                
                API Reference: Provisioning
                </a>
              </li>
            
          </ul>
        </li>
      
    </ul>

  </nav>
</div>


  <article class="doc-page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="Simulating State with Scenarios">
    <meta itemprop="description" content="Some testing activities require that different responses be served for a sequence of identical requests. For instanceif you are testing a to-do list application such as this one you may wish to startwith no to-do list items, post a new item, then see the item appear in the list.">
    <meta itemprop="datePublished" content="October 12, 2020">
    

    <div class="page__inner-wrap">
      <header>
        <h1 class="page__title" itemprop="headline">Simulating State with Scenarios
</h1>
      </header>
      <section class="page__content" itemprop="text">
        <p>Some testing activities require that different responses be served for a sequence of identical requests. For instance
if you are testing a to-do list application <a href="/docs/exploratory-testing-tutorial/">such as this one</a> you may wish to start
with no to-do list items, post a new item, then see the item appear in the list.</p>

<p>Assuming there is a “list to-do items” API call used to fetch the list, this must be called twice during the above test,
returning no items on the first invocation, and the newly added item on the second. Since both of these requests will be
identical (same URL, method, request headers), something additional is required for MockLab to differentiate the first and
second cases.</p>

<p>MockLab’s Scenarios solve this problem by providing finite state machines that can be used as additional stub matching conditions.
They allow more than one definition of an otherwise identical stub with different responses based on the current state of the machine.</p>

<h2 id="example">Example</h2>

<p>To implement the above case, you would declare that the stub returning the empty list is only matched when the scenario state is “Started”,
while the stub returning the list with one item is only matched when the scenario state is “First item added”.</p>

<p>Start by creating the empty list stub, which is matched only when the scenario named “To do list” is in the “Started” state:</p>

<p><img title="Empty to-do list stub" src="/images/screenshots/scenarios-empty-list-stub.png" /></p>

<p>Then create a stub to handle posting of the first list item. When triggered this stub will move the scenario state to “First item added”:</p>

<p><img title="To-do list POST stub" src="/images/screenshots/scenarios-post-item-stub.png" /></p>

<p>Finally, create a stub to return the list containing one item, which is matched only then the scenario is in the “First item added” state:</p>

<p><img title="Single item to-to list stub" src="/images/screenshots/scenario-single-item-stub.png" /></p>

<h2 id="testing">Testing</h2>

<p>First, make a <code class="language-plaintext highlighter-rouge">GET</code> request to fetch the list, which should be empty. You should be able to do this any number of times
without the result changing:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ curl http://example.mocklab.io/todo-items
{
  "items": []
}
</code></pre></div></div>

<p>Now <code class="language-plaintext highlighter-rouge">POST</code> a new item (it actually doesn’t matter what the request body contains, since we didn’t specify a body matcher in the stub):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ curl http://example.mocklab.io/todo-items -X POST
</code></pre></div></div>

<p>This should now have moved the scenario state to “First item added”. Getting the list of items again should now return one item:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ curl http://example.mocklab.io/todo-items
{
  "items": [
    {
      "id": "1",
      "description": "Read all about Scenarios"
    }
  ]
}
</code></pre></div></div>

<h2 id="scenario-reset">Scenario reset</h2>

<p>All scenarios can be reset to their
“Started” state by clicking <img src="/images/screenshots/scenario-reset-button.png" title="Scenario reset button" style="border: none; height: 50px;" />.</p>

        
      </section>

      <footer class="page__meta">
        
        




      </footer>

      
    </div>

    
  </article>

  
  
</div>


    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        

<nav class="page__footer-links">
  <div class="page__footer-links-block">
    <ul>
      <li>&copy; 2020 MockLab</li>
      <li><a href="mailto:info@mocklab.io">info@mocklab.io</a></li>
    </ul>
  </div>

  <div class="page__footer-links-block">
    <h3>Help</h3>
    <ul>
      <li><a href="/docs/getting-started/">Docs</a></li>
      <li><a href="/docs/getting-started/">Blog</a></li>
      <li><a href="https://get.mocklab.io/pricing">Pricing</a></li>
    </ul>
  </div>

  <div class="page__footer-links-block">
    <h3>Solutions</h3>
    <ul>
      <li><a href="/oauth2/">OAuth2</a></li>
    </ul>
  </div>

  <div class="page__footer-links-block">
    <h3>Policies</h3>
    <ul>
      <li><a href="/docs/terms-and-conditions/">Terms and conditions</a></li>
      <li><a href="/docs/privacy-policy/">Privacy policy</a></li>
    </ul>
  </div>

  <div class="page__footer-links-block">
    <ul>

    </ul>
  </div>
</nav>

      </footer>
    </div>

    <script src="/assets/js/main.min.js"></script>




  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-78148205-6', 'auto');
  ga('send', 'pageview');
</script>




<script>
    window.intercomSettings = {
        app_id: "xjme6u4w"
    };
</script>
<script>(function(){var w=window;var ic=w.Intercom;if(typeof ic==="function"){ic('reattach_activator');ic('update',intercomSettings);}else{var d=document;var i=function(){i.c(arguments)};i.q=[];i.c=function(args){i.q.push(args)};w.Intercom=i;function l(){var s=d.createElement('script');s.type='text/javascript';s.async=true;s.src='https://widget.intercom.io/widget/xjme6u4w';var x=d.getElementsByTagName('script')[0];x.parentNode.insertBefore(s,x);}if(w.attachEvent){w.attachEvent('onload',l);}else{w.addEventListener('load',l,false);}}})()</script>


  </body>
</html>

